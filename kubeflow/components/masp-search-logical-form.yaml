name: Search for logical form
description: |
  Search for logical form
inputs:
  - {name: image, description: '', default: ''}
  - {name: owner, description: '', default: ''}
  - {name: split, description: '', default: ''}
  - {name: start_index, description: '', default: ''}
  - {name: max_train, description: '', default: ''}
  - {name: beam_size, description: '', default: ''}
  - {name: num_parallel, description: '', default: ''}
  - {name: additional_args, description: '', default: ''}
implementation: 
  container:
    image: '{{inputs.parameters.image}}'
    command:
    - /bin/bash
    - -ex
    - -c
    - |
      . /opt/genie-toolkit/lib.sh
      parse_args "$0" "image owner split start_index max_train beam_size num_parallel" "$@"
      shift $n
      cd $HOME
      
      aws s3 sync --no-progress s3://geniehai/${owner}/dataset/csqa/BFS/${split} data/BFS/${split}
      aws s3 cp --no-progress s3://geniehai/${owner}/dataset/csqa/kb/items_wikidata_n_tokenized.json data/kb/items_wikidata_n_tokenized.json
      aws s3 cp --no-progress s3://geniehai/${owner}/dataset/csqa/kb/child_par_list.json data/kb/child_par_list.json
      aws s3 cp --no-progress s3://geniehai/${owner}/dataset/csqa/BFS/wikidata.pkl data/BFS/wikidata.pkl
      aws s3 cp --no-progress s3://geniehai/${owner}/dataset/csqa/BFS/type_kb.pkl data/BFS/type_kb.pkl
      aws s3 cp --no-progress s3://geniehai/${owner}/dataset/csqa/BFS/pre_type.pkl data/BFS/pre_type.pkl

      python3 /opt/MaSP/main_bfs_run.py -mode offline -num_parallel ${num_parallel} \
        -beam_size ${beam_size} -start_index ${start_index} -max_train ${max_train} -data_mode dir \
        -data_path data/BFS/${split} -shuffle 1 -out_dir_suffix wo_con -all_lf 0
    
      aws s3 sync  --no-progress data/BFS/${split}_proc_direct_${beam_size}_wo_con s3://geniehai/${owner}/dataset/csqa/BFS/${split}_proc_direct_${beam_size}_wo_con_${start_index}_${max_train}/
    
    args: [
      'cmd',
      --image, {inputValue: image},
      --owner, {inputValue: owner},
      --split, {inputValue: split},
      --start_index, {inputValue: start_index},
      --max_train, {inputValue: max_train},
      --beam_size, {inputValue: beam_size},
      --num_parallel, {inputValue: num_parallel},
      --, {inputValue: additional_args}
    ]
